<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>財經數據追蹤 - 地中海風</title>
  <!-- Google Fonts 引入地中海風格字體 -->
  <link href="https://fonts.googleapis.com/css2?family=Lora:wght@400;700&family=Open+Sans:wght@400;600&display=swap" rel="stylesheet">
  <style>
    html {
      scroll-behavior: smooth; /* 啟用平滑滾動 */
    }
    body {
      margin: 0;
      font-family: 'Open Sans', sans-serif;
      background-color: #f5f6f0; /* 沙色背景 */
      color: #1a759f; /* 更亮的藍色正文文字 */
    }
    .container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 20px;
    }
    h1 {
      font-family: 'Lora', serif;
      color: #0d5d8c; /* 更深的藍色標題 */
      text-align: center;
      font-size: 2.5em;
      margin-bottom: 20px;
      text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.1);
    }
    h2 {
      font-family: 'Lora', serif;
      color: #0d5d8c; /* 與 h1 一致 */
      font-size: 1.8em;
      margin: 0; /* 移除預設外邊距 */
      display: inline-block; /* 讓標題與按鈕在同一行 */
    }
    .section {
      background-color: #ffffff; /* 白色背景，像地中海的白牆 */
      border-radius: 10px;
      padding: 20px;
      margin-bottom: 30px;
      box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
      border: 2px solid #d6e8ee; /* 淺藍邊框 */
      position: relative; /* 確保 TOP 按鈕相對定位 */
    }
    .nav-buttons {
      display: flex;
      flex-wrap: wrap; /* 按鈕在小螢幕上自動換行 */
      gap: 15px; /* 調整間距，讓按鈕更協調 */
      margin-bottom: 10px;
    }
    .download-btn, .nav-btn, .top-btn {
      display: inline-block;
      padding: 10px 20px;
      background-color: #0d5d8c; /* 與標題顏色一致的按鈕 */
      color: white;
      text-decoration: none;
      border-radius: 5px;
      font-weight: 600;
      transition: background-color 0.3s;
    }
    .download-btn:hover, .nav-btn:hover, .top-btn:hover {
      background-color: #1a759f; /* 按鈕懸停時變為正文顏色 */
    }
    /* 圖表標題與按鈕的容器 */
    .chart-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 15px;
    }
    .chart-header .download-btn {
      padding: 8px 15px; /* 稍微縮小按鈕 */
      font-size: 0.9em; /* 縮小字體 */
    }
    /* 圖表容器樣式 */
    .tradingview-widget-container {
      border: 2px solid #d6e8ee; /* 淺藍邊框 */
      border-radius: 5px;
      background-color: #f9fbfc; /* 淺藍背景 */
      margin-bottom: 20px; /* 為 TOP 按鈕留出空間 */
    }
    /* 地中海風格的裝飾元素 */
    .divider {
      height: 4px;
      background: linear-gradient(to right, #0d5d8c, #d6e8ee, #0d5d8c); /* 藍色漸層 */
      margin: 30px 0;
    }
    /* TOP 按鈕定位 */
    .top-btn {
      display: block;
      width: fit-content;
      margin: 10px 0 0 auto; /* 右下角 */
      position: relative; /* 相對定位，確保不被其他元素影響 */
      z-index: 10; /* 確保按鈕在圖表之上 */
    }
    /* 響應式設計 */
    @media (max-width: 768px) {
      h1 {
        font-size: 2em; /* 手機上縮小標題 */
      }
      h2 {
        font-size: 1.5em;
      }
      .section {
        padding: 15px;
      }
      .download-btn, .nav-btn, .top-btn {
        padding: 8px 15px;
        font-size: 0.9em;
      }
      .nav-buttons {
        gap: 8px;
      }
      .tradingview-widget-container {
        height: 300px !important; /* 手機上縮小圖表高度 */
        margin-bottom: 40px; /* 為 TOP 按鈕留出更多空間 */
      }
      .chart-header .download-btn {
        padding: 6px 10px; /* 手機上進一步縮小按鈕 */
        font-size: 0.8em;
      }
      .top-btn {
        padding: 6px 12px; /* 小螢幕上縮小按鈕 */
        font-size: 0.8em; /* 縮小字體 */
        margin-top: 5px; /* 調整間距 */
        position: relative; /* 確保定位正確 */
        z-index: 10; /* 確保不被遮蓋 */
      }
    }
  </style>
</head>
<body>
  <div id="top"></div> <!-- 頁面頂部錨點 -->
  <div class="container">
    <h1>財經數據追蹤</h1>
    
    <!-- 導航按鈕 -->
    <div class="section">
      <div class="nav-buttons">
        <a href="#gold-section" class="nav-btn">黃金價格</a>
        <a href="#tips-section" class="nav-btn">TIPS 實質利率</a>
        <a href="#treasury-section" class="nav-btn">美債殖利率</a>
        <a href="#dxy-section" class="nav-btn">美元指數</a>
        <a href="#vix-section" class="nav-btn">VIX 恐慌指數</a>
        <a href="#usdjpy-section" class="nav-btn">日元匯率</a>
      </div>
    </div>

    <!-- 黃金價格圖表 -->
    <div id="gold-section" class="section">
      <div class="chart-header">
        <h2>黃金價格 (美元/盎司)</h2>
        <a href="#" class="download-btn" id="download-gold">下載黃金 30 天</a>
      </div>
      <div class="tradingview-widget-container">
        <div id="tradingview_gold"></div>
        <script src="https://s3.tradingview.com/tv.js"></script>
        <script>
          new TradingView.widget({
            "width": "100%",
            "height": 400,
            "symbol": "XAUUSD",
            "interval": "D",
            "timezone": "Etc/UTC",
            "theme": "light",
            "style": "1",
            "locale": "zh_TW",
            "toolbar_bg": "#d6e8ee",
            "enable_publishing": false,
            "allow_symbol_change": false,
            "container_id": "tradingview_gold"
          });
        </script>
      </div>
      <a href="#top" class="top-btn">TOP</a>
    </div>

    <!-- 分隔線 -->
    <div class="divider"></div>

    <!-- TIPS 實質利率圖表 -->
    <div id="tips-section" class="section">
      <div class="chart-header">
        <h2>TIPS 實質利率 (%)</h2>
      </div>
      <div class="tradingview-widget-container">
        <div id="tradingview_tips"></div>
        <script>
          new TradingView.widget({
            "width": "100%",
            "height": 400,
            "symbol": "FRED:DFII10", // 修正為 FRED 數據來源
            "interval": "D",
            "timezone": "Etc/UTC",
            "theme": "light",
            "style": "1",
            "locale": "zh_TW",
            "toolbar_bg": "#d6e8ee",
            "enable_publishing": false,
            "allow_symbol_change": false,
            "container_id": "tradingview_tips"
          });
        </script>
      </div>
      <a href="#top" class="top-btn">TOP</a>
    </div>

    <!-- 分隔線 -->
    <div class="divider"></div>

    <!-- 美債殖利率圖表 -->
    <div id="treasury-section" class="section">
      <div class="chart-header">
        <h2>美債殖利率 (%)</h2>
      </div>
      <div class="tradingview-widget-container">
        <div id="tradingview_treasury"></div>
        <script>
          new TradingView.widget({
            "width": "100%",
            "height": 400,
            "symbol": "US10Y", // 修正為正確的 TradingView 符號
            "interval": "D",
            "timezone": "Etc/UTC",
            "theme": "light",
            "style": "1",
            "locale": "zh_TW",
            "toolbar_bg": "#d6e8ee",
            "enable_publishing": false,
            "allow_symbol_change": false,
            "container_id": "tradingview_treasury"
          });
        </script>
      </div>
      <a href="#top" class="top-btn">TOP</a>
    </div>

    <!-- 分隔線 -->
    <div class="divider"></div>

    <!-- 美元指數圖表 -->
    <div id="dxy-section" class="section">
      <div class="chart-header">
        <h2>美元指數 (DXY)</h2>
      </div>
      <div class="tradingview-widget-container">
        <div id="tradingview_dxy"></div>
        <script>
          new TradingView.widget({
            "width": "100%",
            "height": 400,
            "symbol": "DX", // 修正為正確的 TradingView 符號
            "interval": "D",
            "timezone": "Etc/UTC",
            "theme": "light",
            "style": "1",
            "locale": "zh_TW",
            "toolbar_bg": "#d6e8ee",
            "enable_publishing": false,
            "allow_symbol_change": false,
            "container_id": "tradingview_dxy"
          });
        </script>
      </div>
      <a href="#top" class="top-btn">TOP</a>
    </div>

    <!-- 分隔線 -->
    <div class="divider"></div>

    <!-- VIX 恐慌指數圖表 -->
    <div id="vix-section" class="section">
      <div class="chart-header">
        <h2>VIX 恐慌指數</h2>
      </div>
      <div class="tradingview-widget-container">
        <div id="tradingview_vix"></div>
        <script>
          new TradingView.widget({
            "width": "100%",
            "height": 400,
            "symbol": "VIX", // 修正為正確的 TradingView 符號
            "interval": "D",
            "timezone": "Etc/UTC",
            "theme": "light",
            "style": "1",
            "locale": "zh_TW",
            "toolbar_bg": "#d6e8ee",
            "enable_publishing": false,
            "allow_symbol_change": false,
            "container_id": "tradingview_vix"
          });
        </script>
      </div>
      <a href="#top" class="top-btn">TOP</a>
    </div>

    <!-- 分隔線 -->
    <div class="divider"></div>

    <!-- 日元匯率圖表 -->
    <div id="usdjpy-section" class="section">
      <div class="chart-header">
        <h2>日元匯率 (USD/JPY)</h2>
        <a href="#" class="download-btn" id="download-usdjpy">下載日元 30 天</a>
      </div>
      <div class="tradingview-widget-container">
        <div id="tradingview_usdjpy"></div>
        <script>
          new TradingView.widget({
            "width": "100%",
            "height": 400,
            "symbol": "FX:USDJPY",
            "interval": "D",
            "timezone": "Etc/UTC",
            "theme": "light",
            "style": "1",
            "locale": "zh_TW",
            "toolbar_bg": "#d6e8ee",
            "enable_publishing": false,
            "allow_symbol_change": false,
            "container_id": "tradingview_usdjpy"
          });
        </script>
      </div>
      <a href="#top" class="top-btn">TOP</a>
    </div>
  </div>

  <!-- JavaScript 程式碼：抓取數據並生成 CSV -->
  <script>
    // API Key 已填入
    const ALPHA_VANTAGE_API_KEY = '3NWX2KKEI69BSULF'; // Alpha Vantage API Key
    const FRED_API_KEY = '8aa6147667ab7a4204789f2ef1a3588e'; // FRED API Key

    // 定義數據來源
    const dataSources = [
      {
        name: '黃金價格 (美元/盎司)',
        symbol: 'GOLD', // 修正為 Alpha Vantage 支援的黃金符號
        api: 'alpha',
        url: `https://www.alphavantage.co/query?function=TIME_SERIES_DAILY&symbol=GOLD&apikey=${ALPHA_VANTAGE_API_KEY}`
      },
      {
        name: 'TIPS 實質利率 (%)',
        symbol: 'DFII10',
        api: 'fred',
        url: `https://api.stlouisfed.org/fred/series/observations?series_id=DFII10&api_key=${FRED_API_KEY}&file_type=json&sort_order=desc`
      },
      {
        name: '美債殖利率 (%)',
        symbol: 'DGS10',
        api: 'fred',
        url: `https://api.stlouisfed.org/fred/series/observations?series_id=DGS10&api_key=${FRED_API_KEY}&file_type=json&sort_order=desc`
      },
      {
        name: '美元指數 (DXY)',
        symbol: 'DTWEXBGS',
        api: 'fred',
        url: `https://api.stlouisfed.org/fred/series/observations?series_id=DTWEXBGS&api_key=${FRED_API_KEY}&file_type=json&sort_order=desc`
      },
      {
        name: 'VIX 恐慌指數',
        symbol: 'VIXCLS',
        api: 'fred',
        url: `https://api.stlouisfed.org/fred/series/observations?series_id=VIXCLS&api_key=${FRED_API_KEY}&file_type=json&sort_order=desc`
      },
      {
        name: '日元匯率 (USD/JPY)',
        symbol: 'USDJPY',
        api: 'alpha',
        url: `https://www.alphavantage.co/query?function=FX_DAILY&from_symbol=USD&to_symbol=JPY&apikey=${ALPHA_VANTAGE_API_KEY}`
      }
    ];

    // 抓取單一數據並格式化的函數
    async function fetchData(source) {
      try {
        const response = await fetch(source.url);
        const data = await response.json();

        let timeSeries;
        if (source.api === 'alpha') {
          timeSeries = data['Time Series (Daily)'] || data['Time Series FX (Daily)'];
          if (!timeSeries) {
            throw new Error(`${source.name} 數據獲取失敗: ${JSON.stringify(data)}`);
          }

          const entries = Object.entries(timeSeries).slice(0, 30); // 取最近 30 天的數據
          return entries.map(([date, values]) => ({
            date,
            value: parseFloat(values['4. close']).toFixed(2)
          }));
        } else if (source.api === 'fred') {
          const observations = data.observations;
          if (!observations) {
            throw new Error(`${source.name} 數據獲取失敗: ${JSON.stringify(data)}`);
          }

          const entries = observations.slice(0, 30); // 取最近 30 天的數據
          return entries.map(entry => ({
            date: entry.date,
            value: entry.value !== '.' ? parseFloat(entry.value).toFixed(2) : 'N/A'
          }));
        }
      } catch (error) {
        console.error(`抓取 ${source.name} 數據時發生錯誤:`, error);
        return null; // 返回 null 表示抓取失敗
      }
    }

    // 生成並下載 CSV 的函數
    function downloadCSV(data, filename) {
      const sortedData = data.sort((a, b) => b.date.localeCompare(a.date)); // 按日期降序
      const csvRows = [
        '日期,數值', // CSV 標頭，確保使用逗號分隔
        ...sortedData.map(item => `${item.date},${item.value}`) // 每行數據使用逗號分隔
      ].join('\r\n'); // 使用 \r\n 作為換行符，確保兼容性

      const blob = new Blob([csvRows], { type: 'text/csv;charset=utf-8;' });
      const url = URL.createObjectURL(blob);
      const link = document.createElement('a');
      link.setAttribute('href', url);
      link.setAttribute('download', filename);
      document.body.appendChild(link);
      link.click();
      document.body.removeChild(link);
    }

    // 下載黃金數據
    document.getElementById('download-gold').addEventListener('click', async (event) => {
      event.preventDefault();
      const goldSource = dataSources.find(source => source.name === '黃金價格 (美元/盎司)');
      const data = await fetchData(goldSource);
      if (data) {
        downloadCSV(data, 'gold_30_days.csv');
      } else {
        alert('無法抓取黃金數據，請檢查控制台錯誤訊息。');
      }
    });

    // 下載日元數據
    document.getElementById('download-usdjpy').addEventListener('click', async (event) => {
      event.preventDefault();
      const usdjpySource = dataSources.find(source => source.name === '日元匯率 (USD/JPY)');
      const data = await fetchData(usdjpySource);
      if (data) {
        downloadCSV(data, 'usdjpy_30_days.csv');
      } else {
        alert('無法抓取日元數據，請檢查控制台錯誤訊息。');
      }
    });
  </script>
</body>
</html>
