<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>財經數據追蹤 - 地中海風</title>
  <link href="https://fonts.googleapis.com/css2?family=Lora:wght@400;700&family=Open+Sans:wght@400;600&display=swap" rel="stylesheet">
  <style>
    body {
      margin: 0;
      font-family: 'Open Sans', sans-serif;
      background-color: #f5f6f0;
      color: #1a759f;
    }
    .container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 20px;
    }
    .header {
      display: flex;
      align-items: center;
      justify-content: center;
      position: relative;
      margin-bottom: 20px;
    }
    .logo {
      position: absolute;
      left: 0;
    }
    .logo img {
      height: 40px;
      border-radius: 5px;
    }
    h1 {
      font-family: 'Lora', serif;
      color: #0d5d8c;
      text-align: center;
      font-size: 2.5em;
      margin: 0;
    }
    h2 {
      font-family: 'Lora', serif;
      color: #0d5d8c;
      font-size: 1.8em;
      margin: 0;
      display: inline-block;
    }
    .section {
      background-color: #ffffff;
      border-radius: 10px;
      padding: 20px;
      margin-bottom: 30px;
      box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
      border: 2px solid #d6e8ee;
    }
    .chart-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 15px;
    }
    .download-btn {
      padding: 8px 15px;
      background-color: #0d5d8c;
      color: white;
      text-decoration: none;
      border-radius: 5px;
      font-weight: 600;
    }
    .download-btn:hover {
      background-color: #1a759f;
    }
    .tradingview-widget-container {
      width: 100%;
      height: 400px;
      overflow: auto;
      border: 2px solid #d6e8ee;
      border-radius: 5px;
      background-color: #f9fbfc;
      margin-bottom: 10px;
      position: relative;
    }
    .divider {
      height: 4px;
      background: linear-gradient(to right, #0d5d8c, #d6e8ee, #0d5d8c);
      margin: 30px 0;
    }
    .nav-bar {
      display: flex;
      justify-content: center;
      gap: 10px;
      margin-bottom: 20px;
      flex-wrap: wrap;
    }
    .nav-btn {
      padding: 10px 20px;
      background-color: #0d5d8c;
      color: white;
      text-decoration: none;
      border-radius: 5px;
      font-weight: 600;
    }
    .nav-btn:hover {
      background-color: #1a759f;
    }
    .back-to-top {
      position: fixed;
      bottom: 20px;
      right: 20px;
      background-color: #0d5d8c;
      color: white;
      padding: 10px 15px;
      border-radius: 50%;
      text-decoration: none;
      font-size: 1.2em;
      display: none;
      box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
    }
    .back-to-top:hover {
      background-color: #1a759f;
    }
    .error-message {
      color: #d9534f;
      text-align: center;
      padding: 10px;
      border: 1px solid #d9534f;
      border-radius: 5px;
      margin-top: 10px;
    }
    @media (max-width: 768px) {
      h1 { font-size: 2em; }
      h2 { font-size: 1.5em; }
      .section { padding: 15px; }
      .tradingview-widget-container { height: 300px; }
      .download-btn { padding: 6px 10px; font-size: 0.9em; }
      .logo img { height: 30px; }
      .back-to-top { padding: 8px 12px; font-size: 1em; }
      .nav-btn { padding: 8px 15px; font-size: 0.9em; }
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <div class="logo">
        <img src="https://github.com/ken168168ken/finance-tracker/blob/main/IMG_0413-removebg-preview-2.png?raw=true" alt="財經追蹤 LOGO">
      </div>
      <h1>財經數據追蹤</h1>
    </div>

    <!-- 導航欄 -->
    <div class="nav-bar">
      <a href="#gold-section" class="nav-btn">黃金價格</a>
      <a href="#tips-section" class="nav-btn">TIPS 實質利率</a>
      <a href="#us-bond-section" class="nav-btn">美國債利率</a>
      <a href="#dxy-section" class="nav-btn">美元指數</a>
      <a href="#vix-section" class="nav-btn">VIX 恐慌指數</a>
      <a href="#usdjpy-section" class="nav-btn">日元匯率</a>
    </div>

    <!-- 黃金價格圖表 -->
    <div id="gold-section" class="section">
      <div class="chart-header">
        <h2>黃金價格 (美元/盎司)</h2>
        <a href="#" class="download-btn" id="download-gold">下載黃金 30 天</a>
      </div>
      <div class="tradingview-widget-container">
        <div id="tradingview_gold"></div>
        <script src="https://s3.tradingview.com/tv.js"></script>
        <script>
          new TradingView.widget({
            "width": "100%",
            "height": 400,
            "symbol": "XAUUSD",
            "interval": "D",
            "timezone": "Etc/UTC",
            "theme": "light",
            "style": "1",
            "locale": "zh_TW",
            "toolbar_bg": "#d6e8ee",
            "enable_publishing": false,
            "allow_symbol_change": false,
            "container_id": "tradingview_gold"
          });
        </script>
      </div>
    </div>

    <div class="divider"></div>

    <!-- TIPS 實質利率 -->
    <div id="tips-section" class="section">
      <div class="chart-header">
        <h2>TIPS 實質利率 (%)</h2>
        <a href="#" class="download-btn" id="download-tips">下載 TIPS 30 天</a>
      </div>
      <div class="tradingview-widget-container">
        <div id="tradingview_tips"></div>
        <script>
          new TradingView.widget({
            "width": "100%",
            "height": 400,
            "symbol": "FRED:T10YIE",
            "interval": "D",
            "timezone": "Etc/UTC",
            "theme": "light",
            "style": "1",
            "locale": "zh_TW",
            "toolbar_bg": "#d6e8ee",
            "enable_publishing": false,
            "allow_symbol_change": false,
            "container_id": "tradingview_tips"
          });
        </script>
      </div>
    </div>

    <div class="divider"></div>

    <!-- 美國債利率 -->
    <div id="us-bond-section" class="section">
      <div class="chart-header">
        <h2>美國債利率 (%)</h2>
        <a href="#" class="download-btn" id="download-us-bond">下載美國債 30 天</a>
      </div>
      <div class="tradingview-widget-container">
        <div id="tradingview_us_bond"></div>
        <script>
          new TradingView.widget({
            "width": "100%",
            "height": 400,
            "symbol": "TVC:US10Y",
            "interval": "D",
            "timezone": "Etc/UTC",
            "theme": "light",
            "style": "1",
            "locale": "zh_TW",
            "toolbar_bg": "#d6e8ee",
            "enable_publishing": false,
            "allow_symbol_change": false,
            "container_id": "tradingview_us_bond"
          });
        </script>
      </div>
    </div>

    <div class="divider"></div>

    <!-- 美元指數 -->
    <div id="dxy-section" class="section">
      <div class="chart-header">
        <h2>美元指數 (DXY)</h2>
        <a href="#" class="download-btn" id="download-dxy">下載美元指數 30 天</a>
      </div>
      <div class="tradingview-widget-container">
        <div class="error-message">
          美元指數 (DXY) 圖表目前無法顯示，請直接訪問 <a href="https://www.tradingview.com/symbols/TVC-DXY/" target="_blank">TradingView</a> 查看。
        </div>
      </div>
    </div>

    <div class="divider"></div>

    <!-- VIX 恐慌指數 -->
    <div id="vix-section" class="section">
      <div class="chart-header">
        <h2>VIX 恐慌指數</h2>
        <a href="#" class="download-btn" id="download-vix">下載 VIX 30 天</a>
      </div>
      <div class="tradingview-widget-container">
        <div class="error-message">
          VIX 恐慌指數圖表目前無法顯示，請直接訪問 <a href="https://www.tradingview.com/symbols/CBOE-VIX/" target="_blank">TradingView</a> 查看。
        </div>
      </div>
    </div>

    <div class="divider"></div>

    <!-- 日元匯率 -->
    <div id="usdjpy-section" class="section">
      <div class="chart-header">
        <h2>日元匯率 (USD/JPY)</h2>
        <a href="#" class="download-btn" id="download-usdjpy">下載日元 30 天</a>
      </div>
      <div class="tradingview-widget-container">
        <div id="tradingview_usdjpy"></div>
        <script>
          new TradingView.widget({
            "width": "100%",
            "height": 400,
            "symbol": "FX:USDJPY",
            "interval": "D",
            "timezone": "Etc/UTC",
            "theme": "light",
            "style": "1",
            "locale": "zh_TW",
            "toolbar_bg": "#d6e8ee",
            "enable_publishing": false,
            "allow_symbol_change": false,
            "container_id": "tradingview_usdjpy"
          });
        </script>
      </div>
    </div>
  </div>

  <!-- 回到頁首按鈕 -->
  <a href="#" class="back-to-top" id="back-to-top">↑</a>

  <script>
    const ALPHA_VANTAGE_API_KEY = '3NWX2KKEI69BSULF';

    const dataSources = [
      { name: '黃金價格 (美元/盎司)', symbol: 'GOLD', api: 'alpha', url: `https://www.alphavantage.co/query?function=TIME_SERIES_DAILY&symbol=GOLD&apikey=${ALPHA_VANTAGE_API_KEY}` },
      { name: 'TIPS 實質利率 (%)', symbol: 'FRED:T10YIE', api: 'tradingview' },
      { name: '美國債利率 (%)', symbol: 'TVC:US10Y', api: 'tradingview' },
      { name: '美元指數 (DXY)', symbol: 'TVC:DXY', api: 'tradingview' },
      { name: 'VIX 恐慌指數', symbol: 'CBOE:VIX', api: 'tradingview' },
      { name: '日元匯率 (USD/JPY)', symbol: 'USDJPY', api: 'alpha', url: `https://www.alphavantage.co/query?function=FX_DAILY&from_symbol=USD&to_symbol=JPY&apikey=${ALPHA_VANTAGE_API_KEY}` }
    ];

    async function fetchData(source) {
      if (source.api === 'tradingview') return null;
      try {
        const response = await fetch(source.url);
        const data = await response.json();
        let timeSeries = data['Time Series (Daily)'] || data['Time Series FX (Daily)'];
        if (!timeSeries) throw new Error(`${source.name} 數據獲取失敗`);
        const entries = Object.entries(timeSeries).slice(0, 30);
        return entries.map(([date, values]) => ({
          date,
          value: parseFloat(values['4. close']).toFixed(2)
        }));
      } catch (error) {
        console.error(`抓取 ${source.name} 數據時發生錯誤:`, error);
        return null;
      }
    }

    function downloadCSV(data, filename) {
      const sortedData = data.sort((a, b) => b.date.localeCompare(a.date));
      const csvRows = ['日期,數值', ...sortedData.map(item => `${item.date},${item.value}`)].join('\r\n');
      const blob = new Blob([csvRows], { type: 'text/csv;charset=utf-8;' });
      const url = URL.createObjectURL(blob);
      const link = document.createElement('a');
      link.setAttribute('href', url);
      link.setAttribute('download', filename);
      document.body.appendChild(link);
      link.click();
      document.body.removeChild(link);
    }

    document.getElementById('download-gold').addEventListener('click', async (event) => {
      event.preventDefault();
      const goldSource = dataSources.find(source => source.name === '黃金價格 (美元/盎司)');
      const data = await fetchData(goldSource);
      if (data) downloadCSV(data, 'gold_30_days.csv');
      else alert('無法抓取黃金數據，請檢查控制台錯誤訊息。');
    });

    document.getElementById('download-tips').addEventListener('click', (event) => {
      event.preventDefault();
      alert('TIPS 數據無法直接下載，請查看圖表或使用其他數據來源。');
    });

    document.getElementById('download-us-bond').addEventListener('click', (event) => {
      event.preventDefault();
      alert('美國債利率數據無法直接下載，請查看圖表或使用其他數據來源。');
    });

    document.getElementById('download-dxy').addEventListener('click', (event) => {
      event.preventDefault();
      alert('美元指數數據無法直接下載，請直接訪問 TradingView 查看：https://www.tradingview.com/symbols/TVC-DXY/');
    });

    document.getElementById('download-vix').addEventListener('click', (event) => {
      event.preventDefault();
      alert('VIX 數據無法直接下載，請直接訪問 TradingView 查看：https://www.tradingview.com/symbols/CBOE-VIX/');
    });

    document.getElementById('download-usdjpy').addEventListener('click', async (event) => {
      event.preventDefault();
      const usdjpySource = dataSources.find(source => source.name === '日元匯率 (USD/JPY)');
      const data = await fetchData(usdjpySource);
      if (data) downloadCSV(data, 'usdjpy_30_days.csv');
      else alert('無法抓取日元數據，請檢查控制台錯誤訊息。');
    });

    // 回到頁首按鈕的顯示與隱藏
    const backToTopButton = document.getElementById('back-to-top');
    window.addEventListener('scroll', () => {
      if (window.scrollY > 300) {
        backToTopButton.style.display = 'block';
      } else {
        backToTopButton.style.display = 'none';
      }
    });

    backToTopButton.addEventListener('click', (event) => {
      event.preventDefault();
      window.scrollTo({ top: 0, behavior: 'smooth' });
    });
  </script>
</body>
</html>
